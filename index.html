<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Диктант</title>
<style>

body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#4e73df,#1cc88a);
  margin:0;
  padding:0;
}

.container {
  background:white;
  max-width:650px;
  margin:40px auto;
  padding:30px;
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
}

h1 {
  text-align:center;
}

input {
  width:100%;
  padding:8px;
  margin-top:5px;
  margin-bottom:15px;
  border-radius:8px;
  border:1px solid #ccc;
}

button {
  background:#4e73df;
  color:white;
  padding:10px 15px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

button:hover {
  background:#2e59d9;
}

.correct { color:green; font-weight:bold; }
.wrong { color:red; font-weight:bold; }

.grade-box {
  background:#f8f9fc;
  padding:15px;
  border-radius:10px;
  margin-bottom:20px;
}

.grade-scale {
  margin-top:10px;
  font-size:14px;
}

.modal {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.5);
  display:flex;
  justify-content:center;
  align-items:center;
}

.modal-content {
  background:white;
  padding:30px;
  border-radius:15px;
  max-width:400px;
  text-align:center;
}

</style>
</head>

<body>

<div class="modal" id="instructionModal">
  <div class="modal-content">
    <h2>Инструкция</h2>
    <p id="instructionText"></p>

    <div class="grade-scale">
      <b>Шкала оценок:</b><br>
      90–100% → 5<br>
      80–89% → 4<br>
      70–79% → 3<br>
      ниже 70% → 2
    </div>

    <br>
    <button onclick="startTest()">Начать тест</button>
  </div>
</div>

<div class="container">

<h1>Переведи слова</h1>

<button onclick="adminLogin()">Вход для администратора</button>
<br><br>

<div class="grade-box">
<b>Шкала оценок:</b><br>
90–100% → 5<br>
80–89% → 4<br>
70–79% → 3<br>
ниже 70% → 2
</div>

Имя:
<input id="name">

<div id="words"></div>

<button onclick="send()">Отправить</button>

<div id="result"></div>

</div>

<script>

const SETTINGS_BIN = "698f3a3043b1c97be97c510c";
const API_KEY = "$2a$10$sw1K/RXpKK2k3L5l6.wDLuJWKESzfg51etzmCpCb/Q6sEKy0Oudwi";

let words = [];
let instruction = "";

async function loadSettings() {

  let res = await fetch(`https://api.jsonbin.io/v3/b/${SETTINGS_BIN}/latest`, {
    headers: {"X-Master-Key": API_KEY}
  });

  let data = await res.json();

  words = data.record.words || [];
  instruction = data.record.instruction || "";

  document.getElementById("instructionText").innerText = instruction;

  let html = "";

  words.forEach((w,i)=>{
    html += `
      ${w.ru}
      <input id="w${i}">
    `;
  });

  document.getElementById("words").innerHTML = html;
}

function startTest() {
  document.getElementById("instructionModal").style.display = "none";
}

async function send() {

  let name = document.getElementById("name").value.trim();

  if(!name){
    alert("Введите имя");
    return;
  }

  let correct = 0;
  let resultHTML = "";

  words.forEach((w,i)=>{

    let val = document.getElementById("w"+i).value.trim().toLowerCase();

    if(val === w.en.toLowerCase()) {
      correct++;
      resultHTML += `<p class="correct">${w.ru} → ${val} ✅</p>`;
    } else {
      resultHTML += `<p class="wrong">${w.ru} → ${val || "(пусто)"} ❌ Ошибка. Правильно: <b>${w.en}</b></p>`;
    }
  });

  let percent = Math.round((correct / words.length) * 100);

  let grade = 2;
  let gradeColor = "red";

  if(percent >= 90) { grade = 5; gradeColor = "green"; }
  else if(percent >= 80) { grade = 4; gradeColor = "#2e59d9"; }
  else if(percent >= 70) { grade = 3; gradeColor = "orange"; }
  else { grade = 2; gradeColor = "red"; }

  document.getElementById("result").innerHTML =
    `<h2>Результат: ${correct}/${words.length}</h2>
     <h3>Процент: ${percent}%</h3>
     <h2 style="color:${gradeColor}">Оценка: ${grade}</h2>
     <hr>` + resultHTML;
}

function adminLogin() {
  let pass = prompt("Введите пароль администратора");
  if(pass === "admin123") location.href="admin.html";
}

loadSettings();

</script>

</body>
</html>
