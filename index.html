<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dictation System</title>

<style>

body{
font-family:Arial;
background:linear-gradient(135deg,#4e73df,#1cc88a);
margin:0;
padding:0;
text-align:center;
}

.container{
background:white;
max-width:900px;
margin:30px auto;
padding:25px;
border-radius:15px;
box-shadow:0 10px 30px rgba(0,0,0,0.2);
}

button{
padding:8px 15px;
margin:5px;
border:none;
border-radius:8px;
cursor:pointer;
background:#4e73df;
color:white;
}

input, textarea{
padding:8px;
margin:5px;
font-size:16px;
}

.correct{color:green;}
.wrong{color:red;}

#test,#adminPanel,#adminLogin{
display:none;
text-align:left;
}

</style>
</head>
<body>

<div class="container">

<h2>Ученики</h2>

<div id="studentsList"></div>

<hr>

<button onclick="showAdminLogin()">Tutor</button>

<div id="adminLogin">

<input type="password" id="adminPass" placeholder="Пароль">

<button onclick="loginAdmin()">Войти</button>

</div>

<div id="adminPanel">

<h3>Добавить / редактировать ученика</h3>

<input id="studentName" placeholder="Имя ученика">

<br>

<textarea id="studentWords" rows="8" cols="50"
placeholder="дом=house&#10;кот=cat"></textarea>

<br>

<button onclick="saveStudent()">Сохранить</button>

<hr>

<h3>Ученики</h3>

<div id="adminStudents"></div>

<hr>

<div id="adminResults"></div>

</div>

<div id="test">

<h3 id="studentTitle"></h3>

<div id="words"></div>

<button onclick="finishTest()">Отправить</button>

<button onclick="restartTest()">Начать новую попытку</button>

<div id="result"></div>

</div>

</div>

<script>

const ADMIN_PASS="tutorai";

let db=JSON.parse(localStorage.getItem("dictDB"));

if(!db){

db={
students:{},
results:{}
};

saveDB();

}

let currentStudent="";
let currentWords=[];

function saveDB(){

localStorage.setItem("dictDB",JSON.stringify(db));

}

function showAdminLogin(){

document.getElementById("adminLogin").style.display="block";

}

function loginAdmin(){

if(document.getElementById("adminPass").value===ADMIN_PASS){

document.getElementById("adminPanel").style.display="block";

renderAdminStudents();

}else{

alert("Неверный пароль");

}

}

function renderStudents(){

let html="";

for(let name in db.students){

html+=`<button onclick="startTest('${name}')">${name}</button>`;

}

document.getElementById("studentsList").innerHTML=html;

}

function renderAdminStudents(){

let html="";

for(let name in db.students){

html+=`

<div>

<b>${name}</b>

<button onclick="editStudent('${name}')">Редактировать</button>

<button onclick="deleteStudent('${name}')">Удалить</button>

<button onclick="viewResults('${name}')">Результаты</button>

</div>

`;

}

document.getElementById("adminStudents").innerHTML=html;

}

function saveStudent(){

let name=document.getElementById("studentName").value.trim();

let raw=document.getElementById("studentWords").value.trim();

if(!name||!raw){

alert("Введите имя и слова");

return;

}

let lines=raw.split("\n");

db.students[name]=[];

lines.forEach(line=>{

let parts=line.split("=");

if(parts.length===2){

db.students[name].push({

ru:parts[0].trim(),
en:parts[1].trim()

});

}

});

saveDB();

renderStudents();

renderAdminStudents();

alert("Сохранено");

}

function editStudent(name){

document.getElementById("studentName").value=name;

let text="";

db.students[name].forEach(w=>{

text+=`${w.ru}=${w.en}\n`;

});

document.getElementById("studentWords").value=text;

}

function deleteStudent(name){

if(!confirm("Удалить ученика?"))return;

delete db.students[name];

delete db.results[name];

saveDB();

renderStudents();

renderAdminStudents();

}

function startTest(name){

currentStudent=name;

currentWords=db.students[name];

document.getElementById("test").style.display="block";

document.getElementById("studentTitle").innerText="Ученик: "+name;

renderTestWords();

}

function renderTestWords(){

let html="";

currentWords.forEach((w,i)=>{

html+=`

<div>

${w.ru}

<input

id="w${i}"

autocomplete="off"
spellcheck="false"

onpaste="return false"
oncopy="return false"

>

</div>

`;

});

document.getElementById("words").innerHTML=html;

document.getElementById("result").innerHTML="";

}

function finishTest(){

let correct=0;

let details=[];

currentWords.forEach((w,i)=>{

let val=document.getElementById("w"+i).value.trim();

let ok=val.toLowerCase()===w.en.toLowerCase();

if(ok)correct++;

details.push({

ru:w.ru,
correct:w.en,
answer:val,
ok:ok

});

});

let percent=Math.round(correct/currentWords.length*100);

if(!db.results[currentStudent]){

db.results[currentStudent]=[];

}

db.results[currentStudent].push({

percent:percent,
details:details,
date:new Date().toLocaleString()

});

saveDB();

showResult(percent,details);

}

function showResult(percent,details){

let html=`<h3>Результат: ${percent}%</h3>`;

details.forEach(d=>{

if(d.ok){

html+=`<div class="correct">${d.ru} → ${d.answer} ✓</div>`;

}else{

html+=`<div class="wrong">${d.ru} → ${d.answer||"(пусто)"} ✗ Правильно: ${d.correct}</div>`;

}

});

document.getElementById("result").innerHTML=html;

}

function restartTest(){

renderTestWords();

}

function viewResults(name){

let attempts=db.results[name];

if(!attempts){

document.getElementById("adminResults").innerHTML="Нет попыток";

return;

}

let html=`<h3>Результаты: ${name}</h3>`;

attempts.forEach((a,i)=>{

html+=`

<hr>

Попытка ${i+1}

<br>

${a.date}

<br>

${a.percent}%

`;

a.details.forEach(d=>{

if(d.ok){

html+=`<div class="correct">${d.ru} → ${d.answer}</div>`;

}else{

html+=`<div class="wrong">${d.ru} → ${d.answer} | ${d.correct}</div>`;

}

});

});

document.getElementById("adminResults").innerHTML=html;

}

renderStudents();

</script>

</body>
</html>
