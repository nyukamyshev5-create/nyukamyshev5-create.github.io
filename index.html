<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Диктанты</title>

<meta name="autocomplete" content="off">

<style>

body{
font-family:Arial;
background:linear-gradient(90deg,#4e73df,#1cc88a);
margin:0;
}

.container{
background:white;
width:800px;
margin:40px auto;
padding:30px;
border-radius:10px;
}

button{
padding:10px 20px;
margin:5px;
border:none;
border-radius:6px;
background:#4e73df;
color:white;
cursor:pointer;
}

button:hover{
background:#2e59d9;
}

input,textarea{
padding:5px;
margin:5px;
width:300px;
}

.hidden{
display:none;
}

.result{
background:#f8f9fc;
padding:10px;
margin-top:10px;
}

.admin{
background:#fff3cd;
padding:10px;
margin-top:20px;
}

</style>
</head>
<body>

<div class="container">

<h2>Ученики</h2>

<div id="students"></div>

<button onclick="adminLogin()">Админ</button>

<hr>

<div id="testArea" class="hidden">

<h3 id="studentTitle"></h3>

<div id="words"></div>

<button onclick="submitTest()">Отправить</button>

<button onclick="restart()">Начать новую попытку</button>

<div id="result"></div>

</div>

<div id="adminArea" class="hidden" class="admin">

<h3>Админ панель</h3>

<div id="adminStudents"></div>

<h4>Добавить ученика</h4>

<input id="newStudentName" placeholder="Имя">
<br>
<textarea id="newWords" placeholder="пример:
дом=house
кот=cat"></textarea>
<br>
<button onclick="addStudent()">Добавить</button>

</div>

</div>

<script>

/////////////////////////////////////////////////
// ПАРОЛЬ
/////////////////////////////////////////////////

const ADMIN_PASSWORD="tutorai";

/////////////////////////////////////////////////
// БАЗА СЛОВ
/////////////////////////////////////////////////

let students = JSON.parse(localStorage.getItem("studentsDB")) || {

"Полина":[["исследование","research"],["карьера","career"]],
"Ирина":[["пухлый","chubby"],["злодей","villain"]],
"Кира":[["дом","house"],["работа","work"]]

};

/////////////////////////////////////////////////
// РЕЗУЛЬТАТЫ
/////////////////////////////////////////////////

let results = JSON.parse(localStorage.getItem("resultsDB")) || {};

/////////////////////////////////////////////////
// сохранить
/////////////////////////////////////////////////

function saveAll(){

localStorage.setItem("studentsDB",JSON.stringify(students));
localStorage.setItem("resultsDB",JSON.stringify(results));

}

/////////////////////////////////////////////////
// защита
/////////////////////////////////////////////////

document.addEventListener("paste",e=>e.preventDefault());
document.addEventListener("copy",e=>e.preventDefault());
document.addEventListener("contextmenu",e=>e.preventDefault());

/////////////////////////////////////////////////
// показать учеников
/////////////////////////////////////////////////

function renderStudents(){

const div=document.getElementById("students");

div.innerHTML="";

Object.keys(students).forEach(name=>{

const btn=document.createElement("button");

btn.innerText=name;

btn.onclick=()=>startTest(name);

div.appendChild(btn);

});

}

renderStudents();

/////////////////////////////////////////////////
// тест
/////////////////////////////////////////////////

let currentStudent="";
let inputs=[];

function startTest(name){

currentStudent=name;

document.getElementById("studentTitle").innerText=name;

const wordsDiv=document.getElementById("words");

wordsDiv.innerHTML="";

inputs=[];

students[name].forEach(word=>{

const div=document.createElement("div");

div.innerHTML=word[0]+" <input>";

wordsDiv.appendChild(div);

inputs.push(div.querySelector("input"));

});

document.getElementById("testArea").classList.remove("hidden");

}

/////////////////////////////////////////////////
// проверка
/////////////////////////////////////////////////

function normalize(t){

return t.toLowerCase().trim();

}

function submitTest(){

let correct=0;
let details="";
let total=students[currentStudent].length;

students[currentStudent].forEach((word,i)=>{

let answer=normalize(inputs[i].value);

let correctAnswer=normalize(word[1]);

if(answer===correctAnswer){

correct++;
details+="✅ "+word[0]+"<br>";

}else{

details+="❌ "+word[0]+" → "+word[1]+"<br>";

}

});

let percent=Math.round(correct/total*100);

if(!results[currentStudent])
results[currentStudent]=[];

results[currentStudent].push({

date:new Date().toLocaleString(),
percent:percent,
details:details

});

saveAll();

document.getElementById("result").innerHTML=
"<div class='result'>"+
"Процент: "+percent+"%<br>"+details+
"</div>";

}

/////////////////////////////////////////////////
// новая попытка
/////////////////////////////////////////////////

function restart(){

inputs.forEach(i=>i.value="");

document.getElementById("result").innerHTML="";

}

/////////////////////////////////////////////////
// админ вход
/////////////////////////////////////////////////

function adminLogin(){

let pass=prompt("Пароль");

if(pass!==ADMIN_PASSWORD){
alert("Неверный пароль");
return;
}

document.getElementById("adminArea").classList.remove("hidden");

renderAdmin();

}

/////////////////////////////////////////////////
// админ список
/////////////////////////////////////////////////

function renderAdmin(){

const div=document.getElementById("adminStudents");

div.innerHTML="";

Object.keys(students).forEach(name=>{

const block=document.createElement("div");

block.innerHTML=
"<b>"+name+"</b> "+
"<button onclick='showResults(\""+name+"\")'>Результаты</button>"+
"<button onclick='deleteStudent(\""+name+"\")'>Удалить</button>";

div.appendChild(block);

});

}

/////////////////////////////////////////////////
// показать результаты
/////////////////////////////////////////////////

function showResults(name){

let data=results[name]||[];

let html="<h4>"+name+"</h4>";

data.forEach(r=>{

html+="<div class='result'>"+
r.date+" — "+r.percent+"%<br>"+
r.details+
"</div>";

});

document.getElementById("adminStudents").innerHTML=html+
"<button onclick='renderAdmin()'>Назад</button>";

}

/////////////////////////////////////////////////
// удалить ученика
/////////////////////////////////////////////////

function deleteStudent(name){

if(!confirm("Удалить "+name+"?"))return;

delete students[name];
delete results[name];

saveAll();

renderStudents();
renderAdmin();

}

/////////////////////////////////////////////////
// добавить ученика
/////////////////////////////////////////////////

function addStudent(){

let name=document.getElementById("newStudentName").value;

let text=document.getElementById("newWords").value;

let lines=text.split("\n");

let words=[];

lines.forEach(line=>{

let parts=line.split("=");

if(parts.length===2)
words.push([parts[0],parts[1]]);

});

students[name]=words;

saveAll();

renderStudents();
renderAdmin();

}

</script>

</body>
</html>
