<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Диктанты</title>

<meta name="autocomplete" content="off">
<meta name="autofill" content="off">
<meta name="format-detection" content="telephone=no">
<meta http-equiv="Cache-Control" content="no-store">

<style>
body{
    font-family: Arial;
    background: linear-gradient(135deg,#4e73df,#1cc88a);
    margin:0;
}

.container{
    background:white;
    width:700px;
    margin:40px auto;
    padding:30px;
    border-radius:15px;
    text-align:center;
}

button{
    padding:10px 20px;
    margin:5px;
    border:none;
    border-radius:8px;
    background:#4e73df;
    color:white;
    cursor:pointer;
}

button:hover{
    background:#2e59d9;
}

input{
    padding:8px;
    margin:5px;
    width:250px;
}

.hidden{
    display:none;
}
</style>
</head>

<body oncopy="return false" onpaste="return false" oncut="return false">

<div class="container">

<h2>Выберите ученика</h2>

<div id="students"></div>

<hr>

<button onclick="enterTutor()">Tutor</button>

<div id="testBlock" class="hidden">

<h3 id="studentName"></h3>

<p>Переведи:</p>

<div id="questions"></div>

<button onclick="submitTest()">Отправить</button>

<br><br>

<button onclick="newAttempt()">Пройти тест заново</button>

<p id="result"></p>

</div>

</div>

<script>

// ===== ЗАЩИТА =====

// блок вставки
document.addEventListener("paste", e => e.preventDefault());

// блок ctrl+v
document.addEventListener("keydown", e=>{
    if(e.ctrlKey && e.key==="v") e.preventDefault();
});

// отключение autocomplete полностью
document.addEventListener("focusin", e=>{
    if(e.target.tagName==="INPUT"){
        e.target.setAttribute("autocomplete","new-password");
        e.target.setAttribute("readonly",true);
        setTimeout(()=>e.target.removeAttribute("readonly"),100);
    }
});

// ===== УЧЕНИКИ ПО УМОЛЧАНИЮ =====

const defaultStudents = [
"Полина",
"Ирина",
"Кира",
"Алексей",
"Григорий",
"Роман",
"Владимир",
"Дарья",
"Ксения",
"Виктория"
];

// восстановление если пропали
if(!localStorage.getItem("students")){
    localStorage.setItem("students",JSON.stringify(defaultStudents));
}

// ===== ВОПРОСЫ =====

const dictation = [
{ru:"запрет",en:"ban"},
{ru:"юмор",en:"humor"},
{ru:"следствие",en:"consequence"},
{ru:"как следствие",en:"as a consequence"}
];

// ===== ЗАГРУЗКА УЧЕНИКОВ =====

function loadStudents(){

    const container=document.getElementById("students");

    const students=JSON.parse(localStorage.getItem("students"));

    container.innerHTML="";

    students.forEach(name=>{

        const btn=document.createElement("button");

        btn.textContent=name;

        btn.onclick=()=>selectStudent(name);

        container.appendChild(btn);

    });

}

// ===== ВЫБОР УЧЕНИКА =====

let currentStudent="";

function selectStudent(name){

    currentStudent=name;

    document.getElementById("studentName").innerText="Ученик: "+name;

    document.getElementById("testBlock").classList.remove("hidden");

    loadQuestions();

}

// ===== ЗАГРУЗКА ВОПРОСОВ =====

function loadQuestions(){

    const container=document.getElementById("questions");

    container.innerHTML="";

    dictation.forEach((q,i)=>{

        const div=document.createElement("div");

        div.innerHTML=`
        ${q.ru}<br>
        <input 
            type="text"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
            spellcheck="false"
            name="q${Math.random()}"
            data-index="${i}"
        ><br><br>
        `;

        container.appendChild(div);

    });

}

// ===== ПРОВЕРКА =====

function submitTest(){

    const inputs=document.querySelectorAll("#questions input");

    let correct=0;

    inputs.forEach(input=>{

        const i=input.dataset.index;

        if(input.value.trim().toLowerCase()===dictation[i].en){

            correct++;

        }

    });

    const percent=Math.round(correct/dictation.length*100);

    document.getElementById("result").innerText=
    "Результат: "+percent+"%";

    saveResult(percent);

}

// ===== СОХРАНЕНИЕ =====

function saveResult(percent){

    let results=JSON.parse(localStorage.getItem("results"))||{};

    if(!results[currentStudent])
        results[currentStudent]=[];

    results[currentStudent].push({
        date:new Date().toLocaleString(),
        percent:percent
    });

    localStorage.setItem("results",JSON.stringify(results));

}

// ===== НОВАЯ ПОПЫТКА =====

function newAttempt(){

    loadQuestions();

    document.getElementById("result").innerText="";

}

// ===== ВХОД В TUTOR =====

function enterTutor(){

    const pass=prompt("Пароль:");

    if(pass==="tutorai"){

        location.href="admin.html";

    }else{

        alert("Неверный пароль");

    }

}

// ===== СТАРТ =====

loadStudents();

</script>

</body>
</html>
