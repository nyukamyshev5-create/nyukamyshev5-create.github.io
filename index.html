<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Диктант</title>
<style>
body {
  font-family: Arial;
  background: linear-gradient(135deg,#4e73df,#1cc88a);
  margin:0;
  padding:0;
}
.container {
  background:white;
  max-width:650px;
  margin:40px auto;
  padding:30px;
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
}
input {
  width:100%;
  padding:8px;
  margin-bottom:15px;
  border-radius:8px;
  border:1px solid #ccc;
}
button {
  background:#4e73df;
  color:white;
  padding:10px 15px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
button:hover { background:#2e59d9; }
.correct { color:green; font-weight:bold; }
.wrong { color:red; font-weight:bold; }
.grade-box {
  background:#f8f9fc;
  padding:15px;
  border-radius:10px;
  margin-bottom:20px;
}
</style>
</head>

<body>

<div class="container">

<h2>Введите имя ученика</h2>
<input id="name">
<button onclick="loadStudent()">Начать</button>

<div id="test" style="display:none;">

<hr>

<h3>Инструкция</h3>
<p id="instruction"></p>

<div class="grade-box">
<b>Шкала оценок:</b><br>
90–100% → 5<br>
80–89% → 4<br>
70–79% → 3<br>
ниже 70% → 2
</div>

<div id="words"></div>

<button onclick="send()">Отправить</button>

<div id="result"></div>

</div>

</div>

<script>

const SETTINGS_BIN = "698f3a3043b1c97be97c510c";
const API_KEY = "$2a$10$sw1K/RXpKK2k3L5l6.wDLuJWKESzfg51etzmCpCb/Q6sEKy0Oudwi";

let words = [];

async function loadStudent() {

  let name = document.getElementById("name").value.trim();

  if(!name){
    alert("Введите имя");
    return;
  }

  let res = await fetch(`https://api.jsonbin.io/v3/b/${SETTINGS_BIN}/latest`, {
    headers: {"X-Master-Key": API_KEY}
  });

  let data = await res.json();

  let students = data.record.students || {};

  if(!students[name]){
    alert("Для этого ученика диктант не найден");
    return;
  }

  words = students[name];

  document.getElementById("instruction").innerText =
    data.record.instruction || "";

  let html = "";

  words.forEach((w,i)=>{
    html += `${w.ru}<input id="w${i}">`;
  });

  document.getElementById("words").innerHTML = html;

  document.getElementById("test").style.display = "block";
}

function send(){

  let correct = 0;
  let resultHTML = "";

  words.forEach((w,i)=>{

    let val = document.getElementById("w"+i).value.trim().toLowerCase();

    if(val === w.en.toLowerCase()){
      correct++;
      resultHTML += `<p class="correct">${w.ru} → ${val} ✅</p>`;
    } else {
      resultHTML += `<p class="wrong">${w.ru} → ${val || "(пусто)"} ❌ Правильно: <b>${w.en}</b></p>`;
    }

  });

  let percent = Math.round((correct/words.length)*100);

  let grade = 2;
  let color="red";

  if(percent>=90){grade=5;color="green";}
  else if(percent>=80){grade=4;color="#2e59d9";}
  else if(percent>=70){grade=3;color="orange";}

  document.getElementById("result").innerHTML =
    `<h2>Результат: ${percent}%</h2>
     <h2 style="color:${color}">Оценка: ${grade}</h2>
     <hr>` + resultHTML;

}

</script>

</body>
</html>
