<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Диктант</title>
</head>

<body>

<h2>Переведи слова</h2>

Имя:<br>
<input id="studentName"><br><br>

<div id="task"></div>

<button onclick="sendResult()">Отправить</button>

<script>

const SETTINGS_BIN = "698f3a3043b1c97be97c510c";
const RESULTS_BIN = "698f3a5c43b1c97be97c5186";
const API_KEY = "$2a$10$sw1K/RXpKK2k3L5l6.wDLuJWKESzfg51etzmCpCb/Q6sEKy0Oudwi";

let pairs = [];

async function loadWords() {

    let res = await fetch(`https://api.jsonbin.io/v3/b/${SETTINGS_BIN}/latest`, {
        headers: { "X-Master-Key": API_KEY }
    });

    let data = await res.json();

    pairs = data.record.pairs || [];

    let html = "";

    pairs.forEach((p, i) => {
        html += `
            ${p.ru}<br>
            <input id="ans${i}"><br><br>
        `;
    });

    document.getElementById("task").innerHTML = html;
}

loadWords();

async function sendResult() {

    let name = document.getElementById("studentName").value;

    let correct = 0;
    let answers = [];

    pairs.forEach((p, i) => {

        let ans = document.getElementById(`ans${i}`).value;
        answers.push(ans);

        if(ans.toLowerCase().trim() === p.en.trim())
            correct++;
    });

    let newResult = {
        name,
        answers,
        correct,
        total: pairs.length,
        date: new Date().toLocaleString()
    };

    let res = await fetch(`https://api.jsonbin.io/v3/b/${RESULTS_BIN}/latest`, {
        headers: { "X-Master-Key": API_KEY }
    });

    let data = await res.json();
    let results = data.record.results || [];

    results.push(newResult);

    await fetch(`https://api.jsonbin.io/v3/b/${RESULTS_BIN}`, {
        method: "PUT",
        headers: {
            "Content-Type": "application/json",
            "X-Master-Key": API_KEY
        },
        body: JSON.stringify({ results })
    });

    alert("Результат отправлен");
}

</script>

</body>
</html>
