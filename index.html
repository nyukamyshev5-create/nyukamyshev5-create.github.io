<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Диктанты</title>

<style>
body{
font-family:Arial;
background:linear-gradient(135deg,#4e73df,#1cc88a);
text-align:center;
margin:0;
padding:0;
}

.container{
background:white;
max-width:700px;
margin:40px auto;
padding:30px;
border-radius:15px;
box-shadow:0 10px 30px rgba(0,0,0,0.2);
}

button{
padding:10px;
margin:5px;
border:none;
border-radius:8px;
background:#4e73df;
color:white;
cursor:pointer;
}

.correct{color:green;}
.wrong{color:red;}

#test{display:none;}
</style>
</head>
<body>

<div class="container">

<h2>Выберите ученика</h2>

<div id="students"></div>

<hr>

<div id="test">

<h3 id="studentName"></h3>

<p id="instruction"></p>

<div id="words"></div>

<button onclick="finish()">Отправить</button>

<div id="result"></div>

</div>

</div>

<script>

const BIN="698f3a3043b1c97be97c510c"

const KEY="$2a$10$sw1K/RXpKK2k3L5l6.wDLuJWKESzfg51etzmCpCb/Q6sEKy0Oudwi"

let DATA
let CURRENT
let WORDS=[]

async function load(){

const res=await fetch(`https://api.jsonbin.io/v3/b/${BIN}/latest`,{

headers:{
"X-Master-Key":KEY
}

})

const json=await res.json()

DATA=json.record

showStudents()

}

function showStudents(){

let html=""

for(let name in DATA.students){

html+=`<button onclick="start('${name}')">${name}</button>`

}

document.getElementById("students").innerHTML=html

}

function start(name){

CURRENT=name

WORDS=DATA.students[name]

document.getElementById("studentName").innerText=name

document.getElementById("instruction").innerText=DATA.instruction

let html=""

WORDS.forEach((w,i)=>{

html+=`${w.ru}<input id="w${i}"><br>`

})

document.getElementById("words").innerHTML=html

document.getElementById("test").style.display="block"

}

async function finish(){

let correct=0

let details=[]

WORDS.forEach((w,i)=>{

let val=document.getElementById("w"+i).value.trim()

let ok=val.toLowerCase()==w.en.toLowerCase()

if(ok) correct++

details.push({
ru:w.ru,
correct:w.en,
answer:val,
ok:ok
})

})

let percent=Math.round(correct/WORDS.length*100)

let grade=2

if(percent>=90) grade=5
else if(percent>=80) grade=4
else if(percent>=70) grade=3

let html=`<h2>${percent}% оценка ${grade}</h2>`

details.forEach(d=>{

if(d.ok)

html+=`<p class="correct">${d.ru} ✔</p>`

else

html+=`<p class="wrong">${d.ru} ошибка → ${d.correct}</p>`

})

document.getElementById("result").innerHTML=html

saveResult(percent,details)

}

async function saveResult(percent,details){

if(!DATA.results) DATA.results={}

if(!DATA.results[CURRENT]) DATA.results[CURRENT]=[]

DATA.results[CURRENT].push({

date:new Date().toLocaleString(),

percent:percent,

details:details

})

await fetch(`https://api.jsonbin.io/v3/b/${BIN}`,{

method:"PUT",

headers:{

"Content-Type":"application/json",

"X-Master-Key":KEY

},

body:JSON.stringify(DATA)

})

}

load()

</script>

</body>
</html>
