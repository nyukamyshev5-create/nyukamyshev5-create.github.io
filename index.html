<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Student</title>

<style>
body{
  font-family:Arial;
  padding:30px;
  background:#f4f6f9;
}

.panel{
  background:white;
  padding:20px;
  border-radius:12px;
  max-width:800px;
  margin:auto;
  box-shadow:0 8px 25px rgba(0,0,0,0.1);
}

input{
  width:100%;
  padding:6px;
  margin:5px 0;
}

button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#4e73df;
  color:white;
}
</style>

</head>
<body>

<div class="panel">

<h2>Введите имя</h2>
<input id="studentName">
<button onclick="start()">Начать</button>

<div id="test" style="display:none;">
<hr>
<h3 id="instruction"></h3>
<div id="words"></div>
<button onclick="finish()">Завершить</button>
</div>

<div id="result"></div>

</div>

<script>

const SETTINGS_BIN="698f3a3043b1c97be97c510c";
const API_KEY="$2a$10$sw1K/RXpKK2k3L5l6.wDLuJWKESzfg51etzmCpCb/Q6sEKy0Oudwi";

let settings={};
let currentName="";
let currentWords=[];

async function load(){
 let res=await fetch(`https://api.jsonbin.io/v3/b/${SETTINGS_BIN}/latest`,{
   headers:{"X-Master-Key":API_KEY}
 });
 let data=await res.json();
 settings=data.record;
 if(!settings.students) settings.students={};
 if(!settings.results) settings.results={};
}

async function start(){

 await load();

 currentName=document.getElementById("studentName").value.trim();

 if(!settings.students[currentName]){
   alert("Ученик не найден");
   return;
 }

 currentWords=settings.students[currentName];

 document.getElementById("instruction").innerText=settings.instruction||"";

 let html="";
 currentWords.forEach((w,index)=>{
   html+=`<p>${w.ru}</p><input id="ans${index}">`;
 });

 document.getElementById("words").innerHTML=html;
 document.getElementById("test").style.display="block";
}

async function finish(){

 let correct=0;
 let details=[];

 currentWords.forEach((w,index)=>{

   let answer=document.getElementById("ans"+index).value.trim();
   let ok=answer.toLowerCase()===w.en.toLowerCase();

   if(ok) correct++;

   details.push({
     ru:w.ru,
     answer:answer,
     correct:w.en,
     ok:ok
   });

 });

 let percent=Math.round((correct/currentWords.length)*100);

 document.getElementById("result").innerHTML=
   `<h3>Ваш результат: ${percent}%</h3>`;

 if(!settings.results[currentName]){
   settings.results[currentName]=[];
 }

 settings.results[currentName].push({
   percent:percent,
   details:details
 });

 await fetch(`https://api.jsonbin.io/v3/b/${SETTINGS_BIN}`,{
   method:"PUT",
   headers:{
     "Content-Type":"application/json",
     "X-Master-Key":API_KEY
   },
   body:JSON.stringify(settings)
 });

}

</script>

</body>
</html>
