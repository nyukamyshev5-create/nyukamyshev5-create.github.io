<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</title>

<style>

body{
 font-family:Arial;
 margin:20px;
 background:#f4f6f9;
}

button{
 padding:6px 12px;
 margin:3px;
 border:none;
 border-radius:6px;
 cursor:pointer;
}

.editBtn{background:#4e73df;color:white;}
.resultBtn{background:#1cc88a;color:white;}
.deleteBtn{background:#e74a3b;color:white;}
.addBtn{background:#36b9cc;color:white;}

textarea{
 width:100%;
 height:150px;
 margin-top:10px;
}

.studentRow{
 background:white;
 padding:10px;
 margin:5px 0;
 border-radius:8px;
}

.resultBlock{
 background:white;
 padding:10px;
 margin-top:10px;
 border-radius:8px;
}

.correct{color:green;}
.wrong{color:red;}

#loginBox{
 width:300px;
 margin:100px auto;
 background:white;
 padding:20px;
 border-radius:10px;
 text-align:center;
}

input{
 padding:8px;
 width:90%;
 margin-top:10px;
}

</style>

</head>
<body>

<div id="loginBox">

<h3>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É</h3>

<input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">

<br><br>

<button onclick="login()">–í–æ–π—Ç–∏</button>

<p id="loginError" style="color:red;"></p>

</div>


<div id="adminPanel" style="display:none;">

<h2>–£—á–µ–Ω–∏–∫–∏</h2>

<div id="studentsList"></div>

<button class="addBtn" onclick="addStudent()">+ –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</button>

<hr>

<h2 id="editorTitle">–†–µ–¥–∞–∫—Ç–æ—Ä</h2>

<textarea id="words"></textarea>
<br>
<button class="editBtn" onclick="saveStudent()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>

<hr>

<h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—á–µ–Ω–∏–∫–∞</h2>

<div id="results"></div>

</div>


<script>

const ADMIN_PASSWORD="tutorai";

const SETTINGS_BIN="698f3a3043b1c97be97c510c";
const API_KEY="$2a$10$sw1K/RXpKK2k3L5l6.wDLuJWKESzfg51etzmCpCb/Q6sEKy0Oudwi";

let settings={};
let currentStudent=null;


function login(){

 let pass=document.getElementById("password").value;

 if(pass===ADMIN_PASSWORD){

   document.getElementById("loginBox").style.display="none";

   document.getElementById("adminPanel").style.display="block";

   load();

 }else{

   document.getElementById("loginError").innerText="–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å";

 }

}


async function load(){

 let res=await fetch(`https://api.jsonbin.io/v3/b/${SETTINGS_BIN}/latest`,{
   headers:{"X-Master-Key":API_KEY}
 });

 let data=await res.json();

 settings=data.record;

 if(!settings.students) settings.students={};
 if(!settings.results) settings.results={};

 renderStudents();
}


function renderStudents(){

 let div=document.getElementById("studentsList");

 div.innerHTML="";

 for(let name in settings.students){

   div.innerHTML+=`
   <div class="studentRow">

     <b>${name}</b>

     <button class="editBtn" onclick="editStudent('${name}')">
       ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
     </button>

     <button class="resultBtn" onclick="showResults('${name}')">
       üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
     </button>

     <button class="deleteBtn" onclick="deleteStudent('${name}')">
       üóë –£–¥–∞–ª–∏—Ç—å
     </button>

   </div>
   `;

 }

}


function editStudent(name){

 currentStudent=name;

 document.getElementById("editorTitle").innerText=
   "–†–µ–¥–∞–∫—Ç–æ—Ä: "+name;

 let text="";

 settings.students[name].forEach(w=>{
   text+=`${w.ru}:${w.en}\n`;
 });

 document.getElementById("words").value=text;

}


function addStudent(){

 let name=prompt("–ò–º—è —É—á–µ–Ω–∏–∫–∞:");

 if(!name) return;

 settings.students[name]=[];

 renderStudents();

}


async function saveStudent(){

 if(!currentStudent){
   alert("–í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞");
   return;
 }

 let lines=document.getElementById("words").value.split("\n");

 let arr=[];

 lines.forEach(line=>{

   let parts=line.split(":");

   if(parts.length==2){

     arr.push({
       ru:parts[0].trim(),
       en:parts[1].trim()
     });

   }

 });

 settings.students[currentStudent]=arr;

 await saveSettings();

 alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ");

}


async function deleteStudent(name){

 if(!confirm("–£–¥–∞–ª–∏—Ç—å —É—á–µ–Ω–∏–∫–∞ "+name+" ?")) return;

 delete settings.students[name];

 if(settings.results[name]){
   delete settings.results[name];
 }

 await saveSettings();

 renderStudents();

 document.getElementById("words").value="";
 document.getElementById("results").innerHTML="";

}


function showResults(name){

 let div=document.getElementById("results");

 div.innerHTML="";

 let attempts=settings.results[name];

 if(!attempts){

   div.innerHTML="–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤";

   return;
 }

 if(!Array.isArray(attempts)){
   attempts=[attempts];
 }

 attempts.forEach((attempt,index)=>{

   let html=`
   <div class="resultBlock">
   <h3>–ü–æ–ø—ã—Ç–∫–∞ ${index+1}: ${attempt.percent}%</h3>
   `;

   attempt.details.forEach(d=>{

     if(d.ok){

       html+=`
       <div class="correct">
       ${d.ru} ‚Üí ${d.answer} ‚úÖ
       </div>
       `;

     }else{

       html+=`
       <div class="wrong">
       ${d.ru} ‚Üí ${d.answer || "(–ø—É—Å—Ç–æ)"} ‚ùå
       (–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${d.correct})
       </div>
       `;

     }

   });

   html+="</div>";

   div.innerHTML+=html;

 });

}


async function saveSettings(){

 await fetch(`https://api.jsonbin.io/v3/b/${SETTINGS_BIN}`,{

   method:"PUT",

   headers:{
     "Content-Type":"application/json",
     "X-Master-Key":API_KEY
   },

   body:JSON.stringify(settings)

 });

}

</script>

</body>
</html>
