<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin</title>

<script src="config.js"></script>

<style>

body{
font-family:Arial;
padding:20px;
}

</style>

</head>
<body>

<h2>Admin</h2>

Пароль:

<input id="pass" type="password">

<button onclick="login()">Вход</button>

<div id="panel"></div>

<script>

let data=null;
let sha=null;

async function login(){

if(document.getElementById("pass").value!==CONFIG.adminPassword){

alert("wrong");

return;

}

await load();

show();

}

async function load(){

const res=await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/data.json`);

const json=await res.json();

sha=json.sha;

data=JSON.parse(atob(json.content));

}

function show(){

let html="Добавить ученика:<br>";

html+=`Имя:<input id="student"><br>`;

html+=`Слова:<br>`;

html+=`<textarea id="words" rows=10 cols=50></textarea><br>`;

html+=`<button onclick="add()">Добавить</button>`;

html+="<hr>";

Object.keys(data.students).forEach(name=>{

html+=name;

html+=` <button onclick="del('${name}')">Удалить</button><br>`;

});

document.getElementById("panel").innerHTML=html;

}

async function add(){

const name=document.getElementById("student").value;

const lines=document.getElementById("words").value.split("\n");

const words=lines.map(l=>{

const p=l.split("=");

return {ru:p[0].trim(),en:p[1].trim()};

});

data.students[name]={words};

await save();

show();

}

async function del(name){

delete data.students[name];

await save();

show();

}

async function save(){

await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/data.json`,{

method:"PUT",

headers:{
Authorization:"token "+CONFIG.token,
"Content-Type":"application/json"
},

body:JSON.stringify({

message:"update",

content:btoa(JSON.stringify(data,null,2)),

sha

})

});

await load();

}

</script>

</body>
</html>
