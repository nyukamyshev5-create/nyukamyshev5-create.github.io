<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tutor</title>

<script src="config.js"></script>

<style>
body{
font-family:Arial;
padding:30px;
background:#f4f6f9;
}

.panel{
background:white;
padding:20px;
border-radius:12px;
max-width:900px;
margin:auto;
box-shadow:0 8px 25px rgba(0,0,0,0.1);
}

button{
padding:6px 10px;
margin:5px;
border:none;
border-radius:6px;
cursor:pointer;
background:#4e73df;
color:white;
}

button:hover{
background:#2e59d9;
}

textarea,input{
width:100%;
margin:5px 0;
padding:6px;
}

.hidden{
display:none;
}

.ok{
color:green;
font-weight:bold;
}

.err{
color:red;
font-weight:bold;
}
</style>

</head>
<body>

<div id="login" class="panel">

<h2>Вход</h2>

<input type="password" id="pass" placeholder="Введите пароль">

<button onclick="login()">Войти</button>

</div>


<div id="panel" class="panel hidden">

<h2>Инструкция</h2>

<textarea id="instruction" rows="3"></textarea>

<button onclick="saveInstruction()">Сохранить инструкцию</button>

<hr>

<h2>Добавить ученика</h2>

Имя:
<input id="name">

Слова (формат: русский:english)
<textarea id="words" rows="10"></textarea>

<button onclick="add()">Добавить ученика</button>

<p id="msg"></p>

<hr>

<h2>Ученики</h2>

<div id="students"></div>

</div>



<script>

function login(){

const entered=document.getElementById("pass").value

if(entered===CONFIG.adminPassword){

document.getElementById("login").classList.add("hidden")

document.getElementById("panel").classList.remove("hidden")

load()

}else{

alert("Неверный пароль")

}

}



async function load(){

const res=await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.file}`)

const json=await res.json()

const content=JSON.parse(atob(json.content))

document.getElementById("instruction").value=content.instruction||""

showStudents(content.students||{})

}



function showStudents(students){

let html=""

for(let name in students){

html+=`<p>${name} <button onclick="remove('${name}')">Удалить</button></p>`

}

document.getElementById("students").innerHTML=html

}



async function saveInstruction(){

const data=await getData()

data.instruction=document.getElementById("instruction").value

await saveData(data)

showMsg("Сохранено")

}



async function add(){

const name=document.getElementById("name").value.trim()

const raw=document.getElementById("words").value.trim()

if(!name||!raw){

showMsg("Заполните всё",true)
return

}

const lines=raw.split("\n")

let words=[]

lines.forEach(line=>{

const parts=line.split(":")

if(parts.length===2){

words.push({

ru:parts[0].trim(),

en:parts[1].trim()

})

}

})

const data=await getData()

if(!data.students) data.students={}

data.students[name]=words

await saveData(data)

showMsg("Ученик добавлен")

load()

}



async function remove(name){

const data=await getData()

delete data.students[name]

await saveData(data)

showMsg("Удалено")

load()

}



async function getData(){

const res=await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.file}`)

const json=await res.json()

return JSON.parse(atob(json.content))

}



async function saveData(data){

const res=await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.file}`)

const json=await res.json()

await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.file}`,{

method:"PUT",

headers:{
Authorization:`Bearer ${CONFIG.token}`,
"Content-Type":"application/json"
},

body:JSON.stringify({

message:"update",

content:btoa(unescape(encodeURIComponent(JSON.stringify(data,null,2)))),

sha:json.sha

})

})

}



function showMsg(text,error){

const el=document.getElementById("msg")

el.innerText=text

el.className=error?"err":"ok"

}

</script>

</body>
</html>
