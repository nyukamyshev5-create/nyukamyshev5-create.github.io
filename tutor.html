<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tutor</title>

<script src="config.js"></script>

<style>

body{
font-family:Arial;
padding:30px;
background:#f4f6f9;
}

.panel{
background:white;
padding:20px;
border-radius:12px;
max-width:900px;
margin:auto;
box-shadow:0 8px 25px rgba(0,0,0,0.1);
}

button{
padding:6px 12px;
margin:5px;
border:none;
border-radius:6px;
cursor:pointer;
background:#4e73df;
color:white;
}

button:hover{
background:#2e59d9;
}

textarea,input,select{
width:100%;
margin:5px 0;
padding:6px;
}

.hidden{
display:none;
}

.student{
border:1px solid #ddd;
padding:10px;
margin:10px 0;
border-radius:8px;
}

.result{
background:#f8f9fc;
padding:10px;
margin-top:10px;
}

</style>

</head>
<body>

<div id="login" class="panel">

<h2>Вход tutor</h2>

<input type="password" id="pass" placeholder="Пароль">

<button onclick="login()">Войти</button>

</div>

<div id="panel" class="panel hidden">

<h2>Инструкция</h2>

<textarea id="instruction" rows="3"></textarea>

<button onclick="saveInstruction()">Сохранить инструкцию</button>

<hr>

<h2>Добавить / изменить ученика</h2>

<input id="studentName" placeholder="Имя ученика">

<textarea id="studentWords" rows="6" placeholder="формат:
русское:english
кот:cat
дом:house"></textarea>

<button onclick="saveStudent()">Сохранить ученика</button>

<hr>

<h2>Ученики</h2>

<div id="students"></div>

</div>

<script>

const PASSWORD="tutorai"

let data={}
let sha=""

function login(){

if(document.getElementById("pass").value===PASSWORD){

document.getElementById("login").classList.add("hidden")

document.getElementById("panel").classList.remove("hidden")

load()

}

}

async function load(){

const res=await fetch(
`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.file}`,
{
headers:{Authorization:`Bearer ${CONFIG.token}`}
})

const json=await res.json()

sha=json.sha

data=JSON.parse(atob(json.content))

document.getElementById("instruction").value=data.instruction||""

renderStudents()

}

function renderStudents(){

let html=""

for(let name in data.students){

html+=`
<div class="student">

<b>${name}</b>

<button onclick="editStudent('${name}')">редактировать</button>

<button onclick="deleteStudent('${name}')">удалить</button>

${renderResult(name)}

</div>
`

}

document.getElementById("students").innerHTML=html

}

function renderResult(name){

if(!data.results)return ""

if(!data.results[name])return ""

let r=data.results[name]

return `
<div class="result">
Результат: ${r.percent}%
</div>
`

}

function editStudent(name){

document.getElementById("studentName").value=name

let text=""

data.students[name].forEach(w=>{

text+=`${w.ru}:${w.en}\n`

})

document.getElementById("studentWords").value=text

}

function deleteStudent(name){

if(!confirm("Удалить ученика?"))return

delete data.students[name]

save()

}

function saveStudent(){

let name=document.getElementById("studentName").value.trim()

let raw=document.getElementById("studentWords").value.trim()

if(!name)return

let words=[]

raw.split("\n").forEach(line=>{

let parts=line.split(":")

if(parts.length>=2){

words.push({

ru:parts[0].trim(),
en:parts[1].trim()

})

}

})

data.students[name]=words

save()

}

function saveInstruction(){

data.instruction=document.getElementById("instruction").value

save()

}

async function save(){

await fetch(
`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.file}`,
{
method:"PUT",
headers:{
Authorization:`Bearer ${CONFIG.token}`,
"Content-Type":"application/json"
},
body:JSON.stringify({
message:"update data",
content:btoa(unescape(encodeURIComponent(JSON.stringify(data,null,2)))),
sha:sha
})
})

load()

}

</script>

</body>
</html>
