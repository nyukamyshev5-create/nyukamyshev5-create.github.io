<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tutor</title>
</head>
<body>

<div id="login">

<h2>Вход</h2>

<input type="password" id="pass">

<button onclick="login()">Войти</button>

</div>

<div id="panel" style="display:none">

<h2>Инструкция</h2>

<textarea id="instruction"></textarea>

<button onclick="saveInstruction()">Сохранить</button>

<hr>

<h2>Добавить ученика</h2>

Имя:

<input id="name">

Слова:

<textarea id="words"></textarea>

<button onclick="addStudent()">Добавить</button>

<hr>

<h2>Ученики</h2>

<div id="students"></div>

</div>

<script>

const PASS="tutorai"

const BIN="698f3a3043b1c97be97c510c"

const KEY="$2a$10$sw1K/RXpKK2k3L5l6.wDLuJWKESzfg51etzmCpCb/Q6sEKy0Oudwi"

let DATA

function login(){

if(document.getElementById("pass").value!=PASS){

alert("Неверный пароль")

return

}

document.getElementById("login").style.display="none"

document.getElementById("panel").style.display="block"

load()

}

async function load(){

const res=await fetch(`https://api.jsonbin.io/v3/b/${BIN}/latest`,{

headers:{

"X-Master-Key":KEY

}

})

DATA=(await res.json()).record

document.getElementById("instruction").value=DATA.instruction

showStudents()

}

function showStudents(){

let html=""

for(let name in DATA.students){

html+=`

<h3>${name}</h3>

<button onclick="deleteStudent('${name}')">Удалить</button>

${showResults(name)}

`

}

document.getElementById("students").innerHTML=html

}

function showResults(name){

if(!DATA.results) return ""

if(!DATA.results[name]) return ""

let html=""

DATA.results[name].forEach((r,i)=>{

html+=`Попытка ${i+1}: ${r.percent}%<br>`

})

return html

}

async function saveInstruction(){

DATA.instruction=document.getElementById("instruction").value

save()

}

async function addStudent(){

let name=document.getElementById("name").value

let raw=document.getElementById("words").value.split("\n")

DATA.students[name]=[]

raw.forEach(line=>{

let parts=line.split(":")

DATA.students[name].push({

ru:parts[0],

en:parts[1]

})

})

save()

}

async function deleteStudent(name){

delete DATA.students[name]

delete DATA.results[name]

save()

}

async function save(){

await fetch(`https://api.jsonbin.io/v3/b/${BIN}`,{

method:"PUT",

headers:{

"Content-Type":"application/json",

"X-Master-Key":KEY

},

body:JSON.stringify(DATA)

})

load()

}

</script>

</body>
</html>
