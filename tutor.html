<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Диктант</title>
<style>

body{
font-family:Arial;
background:linear-gradient(135deg,#4facfe,#43e97b);
margin:0;
padding:20px;
}

.box{
background:white;
padding:20px;
border-radius:10px;
max-width:600px;
margin:auto;
}

input{
width:100%;
padding:8px;
margin:5px;
}

button{
padding:10px;
margin-top:10px;
}

</style>
</head>
<body>

<div class="box">

<h2 id="name"></h2>

<div id="test"></div>

<button onclick="submit()">Отправить</button>

</div>

<script>

const USER="nyukamyshev5-create";
const REPO="nyukamyshev5-create.github.io";
const FILE="data.json";

let student=localStorage.getItem("student");

let words=[];

document.getElementById("name").innerText=student;

async function load(){

const res=await fetch(FILE+"?"+Date.now());
const data=await res.json();

words=data.students[student].words;

const div=document.getElementById("test");

div.innerHTML="";

words.forEach(w=>{

const input=document.createElement("input");

input.placeholder=w.ru;

div.appendChild(input);

});

}

async function submit(){

const token=prompt("token");

const inputs=document.querySelectorAll("input");

const result=[];

inputs.forEach((input,i)=>{

result.push({

ru:words[i].ru,
correct:words[i].en,
answer:input.value

});

});

const res=await fetch(FILE+"?"+Date.now());
const data=await res.json();

data.students[student].attempts.push({

date:new Date().toLocaleString(),

result

});

await save(data,token);

alert("Сохранено");

}

async function save(data,token){

const get=await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${FILE}`);

const json=await get.json();

await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${FILE}`,{

method:"PUT",

headers:{
Authorization:"Bearer "+token,
"Content-Type":"application/json"
},

body:JSON.stringify({

message:"update",

content:btoa(unescape(encodeURIComponent(JSON.stringify(data,null,2)))),

sha:json.sha

})

});

}

load();

</script>

</body>
</html>
